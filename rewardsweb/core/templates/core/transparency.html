{% extends "base_generic.html" %}

{% block title %}
  <title>Transparency Report - {{ PROJECT_NAME }}</title>
{% endblock %}

{% block page_title %}Transparency Report{% endblock %}

{% block content %}
<div class="space-y-6 fade-in">
  <!-- Page Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
    <div>
      <p class="mt-2 text-lg text-base-content/70">
        Create a transparency report for a specific period.
      </p>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Form -->
    <div class="lg:col-span-2">
      <div class="stat-card">
        <div class="flex items-center gap-2 mb-6">
          <i class="fas fa-file-alt text-primary"></i>
          <h2 class="text-xl font-bold">Report Parameters</h2>
        </div>

        <form method="post">
          {% csrf_token %}
          
          {% if form.non_field_errors %}
          <div class="alert alert-error shadow-lg mb-6">
            <div class="flex items-start gap-3">
              <i class="fas fa-exclamation-triangle text-xl mt-0.5"></i>
              <div>
                <h3 class="font-bold">Validation Error</h3>
                {% for error in form.non_field_errors %}
                <div class="text-sm">{{ error }}</div>
                {% endfor %}
              </div>
            </div>
          </div>
          {% endif %}

          <div class="space-y-6">
            <!-- Report Type -->
            <div class="form-control">
              <div class="flex items-center gap-2 mb-3">
                <i class="fas fa-calendar-alt text-warning"></i>
                <label class="label-text font-semibold text-lg">{{ form.report_type.label }}</label>
              </div>
              <div class="bg-base-200 p-1 rounded-xl border-2 border-base-300 flex gap-2">
                {% for radio in form.report_type %}
                <label class="flex items-center space-x-3 cursor-pointer hover:bg-base-300 px-4 py-3 rounded-lg transition-colors duration-200 flex-1 justify-center">
                  {{ radio.tag }}
                  <span class="label-text font-medium text-sm whitespace-nowrap">{{ radio.choice_label }}</span>
                </label>
                {% endfor %}
              </div>
            </div>

            <!-- Monthly -->
            <div id="monthly-fields" class="space-y-4">
              <div class="form-control">
                <div class="flex items-center gap-2 mb-3">
                  <i class="fas fa-calendar-day text-info"></i>
                  <label class="label-text font-semibold text-lg">{{ form.month.label }}</label>
                </div>
                {{ form.month }}
              </div>
              <div class="form-control">
                <div class="flex items-center gap-2 mb-3">
                  <i class="fas fa-calendar-week text-info"></i>
                  <label class="label-text font-semibold text-lg">{{ form.year.label }}</label>
                </div>
                {{ form.year }}
              </div>
            </div>

            <!-- Quarterly -->
            <div id="quarterly-fields" class="hidden space-y-4">
              <div class="form-control">
                <div class="flex items-center gap-2 mb-3">
                  <i class="fas fa-calendar-day text-info"></i>
                  <label class="label-text font-semibold text-lg">{{ form.quarter.label }}</label>
                </div>
                {{ form.quarter }}
              </div>
              <div class="form-control">
                <div class="flex items-center gap-2 mb-3">
                  <i class="fas fa-calendar-week text-info"></i>
                  <label class="label-text font-semibold text-lg">{{ form.year.label }}</label>
                </div>
                {{ form.year }}
              </div>
            </div>

            <!-- Yearly -->
            <div id="yearly-fields" class="hidden space-y-4">
              <div class="form-control">
                <div class="flex items-center gap-2 mb-3">
                  <i class="fas fa-calendar-week text-info"></i>
                  <label class="label-text font-semibold text-lg">{{ form.year.label }}</label>
                </div>
                {{ form.year }}
              </div>
            </div>

            <!-- Custom -->
            <div id="custom-fields" class="hidden space-y-4">
              <div class="form-control">
                <div class="flex items-center gap-2 mb-3">
                  <i class="fas fa-calendar-day text-info"></i>
                  <label class="label-text font-semibold text-lg">{{ form.start_date.label }}</label>
                </div>
                <input type="date" name="start_date" class="input input-bordered w-full" min="{{ min_date }}" max="{{ max_date }}">
              </div>
              <div class="form-control">
                <div class="flex items-center gap-2 mb-3">
                  <i class="fas fa-calendar-day text-info"></i>
                  <label class="label-text font-semibold text-lg">{{ form.end_date.label }}</label>
                </div>
                <input type="date" name="end_date" class="input input-bordered w-full" min="{{ min_date }}" max="{{ max_date }}">
              </div>
            </div>

            <!-- Ordering -->
            <div class="form-control">
                <div class="flex items-center gap-2 mb-3">
                    <i class="fas fa-sort-amount-down text-accent"></i>
                    <label class="label-text font-semibold text-lg">{{ form.ordering.label }}</label>
                </div>
                <div class="bg-base-200 p-1 rounded-xl border-2 border-base-300 flex gap-2">
                    {% for radio in form.ordering %}
                    <label class="flex items-center space-x-3 cursor-pointer hover:bg-base-300 px-4 py-3 rounded-lg transition-colors duration-200 flex-1 justify-center">
                        {{ radio.tag }}
                        <span class="label-text font-medium text-sm whitespace-nowrap">{{ radio.choice_label }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex gap-4 mt-8 pt-6 border-t border-base-300">
            <button type="submit" class="btn btn-primary flex-1">
              <i class="fas fa-cogs mr-2"></i>
              Generate Report
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  {% if report %}
  <div class="stat-card mt-6">
    <div class="flex items-center gap-2 mb-6">
      <i class="fas fa-file-invoice text-success"></i>
      <h2 class="text-xl font-bold">Generated Report</h2>
    </div>
    <div class="form-control">
        <p class="text-lg">Report for period: {{ start_date }} - {{ end_date }}</p>
        <textarea class="textarea textarea-bordered w-full h-96 mt-4" readonly>{{ report }}</textarea>
    </div>
  </div>
  {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const reportTypeRadios = document.querySelectorAll('input[name="report_type"]');
    const monthlyFields = document.getElementById('monthly-fields');
    const quarterlyFields = document.getElementById('quarterly-fields');
    const yearlyFields = document.getElementById('yearly-fields');
    const customFields = document.getElementById('custom-fields');

    function toggleFields() {
        const selectedValue = document.querySelector('input[name="report_type"]:checked').value;
        monthlyFields.classList.toggle('hidden', selectedValue !== 'monthly');
        quarterlyFields.classList.toggle('hidden', selectedValue !== 'quarterly');
        yearlyFields.classList.toggle('hidden', selectedValue !== 'yearly');
        customFields.classList.toggle('hidden', selectedValue !== 'custom');
    }

    reportTypeRadios.forEach(radio => radio.addEventListener('change', toggleFields));
    toggleFields();
});
</script>
{% endblock %}
