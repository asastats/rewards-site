{% extends "core/base_detail.html" %}

{% block title %}
  <title>{{ contributor.name }} - {{ PROJECT_NAME }}</title>
{% endblock %}

{% block page_title %}{{ contributor.name }} info{% endblock %}
{% block page_subtitle %}Contributor profile and contribution history{% endblock %}

{% block header_badge_content %}
  <i class="fas fa-user-check mr-1"></i>
  Contributor
{% endblock %}

{% block alert_content %}
  <!-- Claimable Rewards Section -->
  {% if contributor == user.profile.contributor %}
    {% if contributor.claimable_contributions %}
    <div class="stat-card bg-gradient-to-r from-success/10 to-success/5 border border-success/20">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="p-3 rounded-lg bg-success/20 text-success">
            <i class="fas fa-gift text-xl"></i>
          </div>
          <div>
            <h2 class="text-xl font-bold text-success">Claimable Rewards Available!</h2>
            <p class="text-base-content/70 mt-1">
              You have {{ contributor.claimable_contributions|length }} contribution(s) ready to be claimed.
            </p>
          </div>
        </div>
        <a href="{% url 'claim' %}" hx-boost="false" class="btn btn-outline btn-success btn-lg">
          <i class="fas fa-gift mr-2"></i>
          Claim Rewards
        </a>
      </div>
    </div>
    {% else %}
    <div class="stat-card">
      <div class="flex items-center gap-3">
        <div class="p-3 rounded-lg bg-base-content/10 text-base-content/50">
          <i class="fas fa-info-circle text-xl"></i>
        </div>
        <div>
          <h2 class="text-xl font-bold text-base-content/70">No Claimable Rewards</h2>
          <p class="text-base-content/70 mt-1">
            You don't have any claimable rewards at the moment.
          </p>
        </div>
      </div>
    </div>
    {% endif %}
  {% endif %}
{% endblock %}

{% block detail_title %}Contributor Information{% endblock %}

{% block detail_content %}
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="space-y-4">
      <div class="flex flex-col">
        <span class="text-sm font-semibold text-base-content/70 mb-1">Display Name</span>
        <span class="font-semibold text-lg">
          <i class="fas fa-signature mr-2 text-primary"></i>
          {{ contributor.name }}
        </span>
      </div>

      <div class="flex flex-col">
        <span class="text-sm font-semibold text-base-content/70 mb-1">Wallet Address</span>
        <span class="font-semibold">
          <i class="fas fa-wallet mr-2 {% if contributor.address %}text-success{% else %}text-warning{% endif %}"></i>
          {% if contributor.address %}
          <span class="font-mono text-sm">**********</span>
          {% else %}
          <span class="text-warning">No address provided</span>
          {% endif %}
        </span>
      </div>
    </div>

    <div class="space-y-4">
      <div class="flex flex-col">
        <span class="text-sm font-semibold text-base-content/70 mb-1">Total Rewards</span>
        <span class="font-semibold text-success text-2xl">
          <i class="fas fa-coins mr-2"></i>
          {{ contributor.total_rewards|floatformat:"g" }}
        </span>
      </div>

      <div class="flex flex-col">
        <span class="text-sm font-semibold text-base-content/70 mb-1">Contribution Groups</span>
        <span class="font-semibold text-info">
          <i class="fas fa-layer-group mr-2"></i>
          {{ contributor.contribution_groups|length }}
        </span>
      </div>
    </div>
  </div>

  <!-- Social Handles -->
  {% if contributor.prefetched_handles %}
  <div class="mt-6 pt-6 border-t border-base-300">
    <h3 class="font-semibold text-lg mb-4">Social Handles</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      {% for handle in contributor.prefetched_handles %}
      <div class="flex items-center gap-3 p-3 rounded-lg">
        <div class="p-2 rounded-lg bg-secondary/10 text-secondary">
          <i class="fab fa-{{ handle.platform.name|lower }}"></i>
        </div>
        <div>
          <span class="text-sm font-semibold text-base-content/70">{{ handle.platform.name }}</span>
          <p class="font-medium">{{ handle.handle }}</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}
{% endblock %}

{% block additional_content %}
  <!-- Contributions -->
  {% for group in contributor.contribution_groups %}
    {% if group.query %}
    <div class="stat-card">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <i class="fas fa-code-branch text-primary"></i>
          <h2 class="text-xl font-bold">{{ group.name }} Contributions</h2>
        </div>
        {% if group.total %}
        <div class="badge badge-primary badge-lg">
          {{ group.total|floatformat:"g" }}
        </div>
        {% endif %}
      </div>

      <div class="space-y-4">
        {% for contribution in group.query reversed %}
        <div class="flex items-center justify-between p-4 rounded-lg hover:bg-base-200 transition-colors group">
          <div class="flex items-center gap-4">
            <div class="p-2 rounded-lg bg-primary/10 text-primary">
              <i class="fas fa-gem"></i>
            </div>
            <div>
              <div class="flex items-center gap-3 mb-1">
                <span class="font-semibold text-base-content/70">Cycle:</span>
                <a class="link link-accent font-semibold hover:no-underline" href="{{ contribution.cycle.get_absolute_url }}">
                  {{ contribution.cycle }}
                </a>
              </div>
              <div class="flex items-center gap-3">
                <span class="font-semibold text-base-content/70">Reward:</span>
                <a class="link link-accent font-semibold hover:no-underline" href="{{ contribution.get_absolute_url }}">
                  {{ contribution.reward }}
                </a>
              </div>
            </div>
          </div>
          <i class="fas fa-chevron-right text-base-content/30 group-hover:text-base-content/60 transition-colors"></i>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  {% empty %}
  <div class="stat-card text-center py-12">
    <i class="fas fa-inbox text-4xl text-base-content/30 mb-4"></i>
    <h3 class="text-xl font-semibold mb-2">No Contributions Found</h3>
    <p class="text-base-content/70 max-w-md mx-auto">
      This contributor doesn't have any recorded contributions yet.
    </p>
  </div>
  {% endfor %}
{% endblock %}

{% block sidebar_content %}

  <!-- Quick Actions -->
  <div class="space-y-6">
    <!-- Quick Actions Card -->
    <div class="stat-card">
      <div class="flex items-center gap-2 mb-4">
        <i class="fas fa-rocket text-accent"></i>
        <h2 class="text-xl font-bold">Quick Actions</h2>
      </div>

      <div class="space-y-3">
        <a href="{% url 'index' %}" class="btn btn-outline justify-start w-full">
          <i class="fas fa-arrow-left mr-2"></i>
          Back to Home
        </a>
        <a href="{% url 'contributors' %}" class="btn btn-outline justify-start w-full">
          <i class="fas fa-users mr-2"></i>
          All Contributors
        </a>
        <a href="{% url 'cycles' %}" class="btn btn-outline justify-start w-full">
          <i class="fas fa-sync-alt mr-2"></i>
          View Cycles
        </a>
        <a href="{% url 'issues' %}" class="btn btn-outline justify-start w-full">
          <i class="fas fa-tasks mr-2"></i>
          Browse Issues
        </a>
      </div>
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="stat-card">
    <div class="flex items-center gap-2 mb-4">
      <i class="fas fa-chart-bar text-info"></i>
      <h2 class="text-xl font-bold">Contributor Stats</h2>
    </div>

    <div class="space-y-4">
      <div class="flex justify-between items-center">
        <span class="text-base-content/70">Total Rewards</span>
        <span class="font-semibold text-success">{{ contributor.total_rewards|floatformat:"g" }}</span>
      </div>

      <div class="flex justify-between items-center">
        <span class="text-base-content/70">Contribution Groups</span>
        <span class="font-semibold text-primary">
          {{ contributor.contribution_groups|length }}
        </span>
      </div>

      <div class="flex justify-between items-center">
        <span class="text-base-content/70">Social Platforms</span>
        <span class="font-semibold text-secondary">
          {{ contributor.prefetched_handles|length }}
        </span>
      </div>

      <div class="flex justify-between items-center">
        <span class="text-base-content/70">Address Status</span>
        <span class="badge {% if contributor.address %}badge-success{% else %}badge-warning{% endif %}">
          {% if contributor.address %}Registered{% else %}Not Set{% endif %}
        </span>
      </div>
    </div>
  </div>

{% endblock %}